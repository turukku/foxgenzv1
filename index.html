<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Generator Link — V1</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background: #111;
        font-family: Inter, Arial;
        font-size: small;
        color: #fff;
      }
      #snow-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        pointer-events: none;
      }
      .card-custom {
        background: rgba(0, 0, 0, 0.55);
        border-radius: 10px;
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .form-control {
        background: rgba(255, 255, 255, 0.08);
        border: none;
        height: 36px;
        color: #fff;
      }
      .btn-primary {
        background: #3f6bff;
        border: none;
        height: 36px;
      }
      .title {
        font-size: 1.4rem;
        font-weight: 600;
      }
      hr {
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }
    </style>
  </head>
  <body>
    <canvas id="snow-canvas"></canvas>

    <div
      class="container d-flex justify-content-center align-items-center"
      style="min-height: 100vh; position: relative; z-index: 2"
    >
      <div
        class="card card-custom p-4 w-100"
        style="max-width: 520px; animation: fadeIn 0.8s ease"
      >
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h3 class="title mb-0">Generator Link</h3>
        </div>

        <hr />

        <div class="form-row">
          <div class="col-9 mb-2">
            <input
              type="text"
              id="inputUserid"
              class="form-control"
              placeholder="Click ID"
              value="OPET-BIO"
            />
          </div>
          <div class="col-3 mb-2">
            <input
              class="form-control"
              type="number"
              name="length"
              id="inputLength"
              min="1"
              value="1"
            />
          </div>
          <div class="col-12">
            <label class="text-light mb-0">Shortlink :</label>
            <select
              class="form-select form-control mt-2"
              id="ShortlinkProvider"
            >
              <option selected value="default">Default</option>
              <option value="sty.ink">sty.ink</option>
            </select>
          </div>
          <div class="col-12">
            <button id="btnGenerate" class="btn btn-primary btn-block mt-3">
              Generate
            </button>
          </div>
        </div>

        <hr />

        <div id="result" class="mt-2" style="display: block">
          <label class="text-light mb-1">Hasil:</label>
          <div class="input-group mb-2">
            <textarea
              id="resultBox"
              class="form-control bg-dark"
              readonly
            ></textarea>
          </div>
          <button id="btnCopy" class="btn btn-warning btn-block">Copy</button>
        </div>

        <div class="text-right mt-3 text-secondary" style="font-size: 0.8rem">
          Made with ❤️ <b>FOXCREW</b>
        </div>
      </div>
    </div>

    <script>
      const cpa = "https://wongetekocak.blogspot.com/?userid=";
      const inputUserid = document.getElementById("inputUserid");
      const inputLength = document.getElementById("inputLength");
      const shortlinkProvider = document.getElementById("ShortlinkProvider");
      const btnGenerate = document.getElementById("btnGenerate");
      const btnCopy = document.getElementById("btnCopy");
      const resultBox = document.getElementById("resultBox");

      // Random string
      function randomString(length) {
        const chars =
          "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        return Array.from({ length }, () =>
          chars.charAt(Math.floor(Math.random() * chars.length))
        ).join("");
      }

      // Shortiny request (proxy Worker)
      async function createShortiny(urlTarget) {
        try {
          const response = await fetch(
            "https://proxy.kentudiair89.workers.dev/",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ targetUrl: urlTarget }),
            }
          );

          if (!response.ok) {
            return { error: true, message: "Request gagal. CORS? Server?" };
          }

          const data = await response.json();

          if (data.short_url) {
            return { shortenedUrl: data.short_url };
          } else {
            return {
              error: true,
              message: data.message || "Gagal membuat link",
            };
          }
        } catch (e) {
          return { error: true, message: e.message };
        }
      }

      // Generate
      btnGenerate.onclick = async function () {
        let click_id = inputUserid.value.trim().toUpperCase();
        let total = parseInt(inputLength.value.trim());
        let provider = shortlinkProvider.value;

        if (!click_id) return alert("Click ID wajib diisi!");
        if (!total || total < 1) return alert("Jumlah minimal 1!");

        let links = [];
        btnGenerate.disabled = true;
        btnGenerate.innerText = "Generating...";

        if (provider === "default") {
          for (let i = 0; i < total; i++) {
            const full = cpa + click_id + "&r=" + randomString(25);
            links.push(full);
          }
          resultBox.value = links.join("\n");
          btnGenerate.disabled = false;
          btnGenerate.innerText = "Generate";
          return;
        }

        // Provider sty.ink via Shortiny
        for (let i = 0; i < total; i++) {
          const full = cpa + click_id + "&r=" + randomString(25);
          const result = await createShortiny(full);

          if (!result.error && result.shortenedUrl) {
            links.push(result.shortenedUrl);
          } else {
            links.push("[Error] " + result.message);
          }

          resultBox.value = links.join("\n"); // update realtime
        }

        btnGenerate.disabled = false;
        btnGenerate.innerText = "Generate";
      };

      btnCopy.onclick = function () {
        resultBox.select();
        document.execCommand("copy");
        btnCopy.innerText = "Copied!";
        setTimeout(() => (btnCopy.innerText = "Copy"), 900);
      };
    </script>

    <!-- Snow Effect -->
    <script>
      const canvas = document.getElementById("snow-canvas");
      const ctx = canvas.getContext("2d");
      let W = (canvas.width = window.innerWidth);
      let H = (canvas.height = window.innerHeight);
      const flakes = [];

      function rand(min, max) {
        return Math.random() * (max - min) + min;
      }

      function Flake() {
        this.x = rand(0, W);
        this.y = rand(0, H);
        this.r = rand(1.2, 3.8);
        this.speed = rand(0.4, 1.2);
        this.opacity = rand(0.5, 1);
        this.angle = rand(0, Math.PI * 2);
      }

      Flake.prototype.update = function () {
        this.y += this.speed;
        this.x += Math.sin(this.angle) * 0.6;
        this.angle += 0.01;
        if (this.y > H) {
          this.y = -5;
          this.x = rand(0, W);
        }
      };

      Flake.prototype.draw = function () {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255,255,255,${this.opacity})`;
        ctx.fill();
      };

      function init() {
        flakes.length = 0;
        for (let i = 0; i < (W * H) / 16000; i++) flakes.push(new Flake());
      }

      function animate() {
        ctx.clearRect(0, 0, W, H);
        flakes.forEach((f) => {
          f.update();
          f.draw();
        });
        requestAnimationFrame(animate);
      }

      window.onresize = () => {
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
        init();
      };

      init();
      animate();
    </script>
  </body>
</html>
